{template 'common/header'}
<script>
</script>
<style>
	body{background:#d2e6e9;}
	.panel{margin:.5em; border:none;}
	.panel-info>.panel-heading {background: -webkit-gradient(linear, 0 0, 100% 0, from(#ebebeb), to(#f3f9fa), color-stop(30%, #f5f9f9)); color:#666666; border:none;}
	a{color:#666666;}a:hover{color: #3ebacc;}
	.nav-tabs>li.active>a, .nav-tabs>li.active>a:hover, .nav-tabs>li.active>a:focus{color: #3ebacc;}
	.actions{margin:.8em auto;}
	.nav.nav-tabs{margin-bottom:.8em;}
	.btn.btn-primary{background: #56c6d6; color: #FFF; border: 0;}
	/**/
#poptip { display:block;position: fixed; top:30%;left:50%;width:160px;margin-left:-80px;height: 80px;background:#000; opacity: 0.7;filter:alpha(opacity=0.7); color:#fff;z-index: 999;  border-radius:5px;-webkit-border-radius:5px;-moz-border-radius:5px;}
#poptip_content { display:block;position: fixed; top:30%;left:50%;width:160px;margin-left:-80px; height: 27px; color:#fff;text-align:center;font-size:14px;z-index: 9909;text-align:center;line-height:80px}

</style>
<div class="panel panel-info ng-container" >
	<div class="panel-heading">
		<h4>手机验证</h4>
	</div>
	<div class="panel-body">
	
		<ul class="nav nav-tabs" role="tablist">
			
				
				<li class="active"><a  role="tab" data-toggle="tab">手机验证</a></li>
			
		</ul>
		<div class="tab-content">
			
			
				<div class="tab-pane animated active" id="code">
					<div class="form-group has-feedback">
						<label class="control-label sr-only"></label>
						<input  type="number" name="mobile" class="form-control" placeholder="请输入您的手机号" id="mobile">
						
					</div>
					{if $res['telephoneconfirm']!=1}
					<div class="form-group has-feedback" >
						
						
						<label class="radio-inline">
							<input type="radio" name="gender" value="1" id="xh" {if $res['gender'] == '1'}checked="true"{/if}> 男
						</label>
						<label class="radio-inline">
							<input type="radio" name="gender" value="2" id="xh"  {if $res['gender'] == '2'}checked="true"{/if}>女
						</label>
						<span class="help-block" style="color:red">注意：提交成功后、此项不可修改</span>
			
						
					</div>
					{/if}
					<div class="form-group">
						<button class="btn btn-warning btn-block btn-sender" onclick="settime()">获取验证码</button>
					</div>
					<div class="form-group has-feedback">
						<label class="control-label sr-only"></label>
						<input  type="number" class="form-control" id="yzm" placeholder="验证码">
						
					</div>
				</div>
			
		</div>
		<button type="submit" class="btn btn-primary btn-block" onclick="login2();">确定</button>

	
	</div>
</div>
<script>
var detail_countdown=60; 
var detail_timer;
function settime() {  
    var button = $(".btn-sender");
	var mobile = $("input[name='mobile']").val();
	var telreg = /^1[3|4|5|7|8][0-9]\d{8}$|^\d{8}$/;
	if(mobile.length==0){
			tip('请先填写手机号码！',true);
			return;
	}else if(!telreg.test(mobile)){
			alert('请填写正确的手机号码！',true);
			return;
	}else{  
        button.attr("disabled", "true");  
        button.text("倒计时" + detail_countdown + "秒");  
        detail_timer = window.setInterval(SetRemainTime, 1000);
		$.post("{php echo $this->createMobileUrl('smssend')}", {mobile:mobile}).success(function(dat){
			if(dat == '1') {
				alert('短信验证码成功发送到您的手机！');
			} else {
			    clearInterval(window.detail_timer);//停止计时器  
				button.removeAttr("disabled");//启用按钮  
				button.html("重新发送验证码");       
				alert('短信发送失败！');
			}
		});
    } 
} 
//timer处理函数  
function SetRemainTime() {  
  var button = $(".btn-sender");
    if (detail_countdown == 0) {
        clearInterval(window.detail_timer);//停止计时器  
        button.removeAttr("disabled");//启用按钮  
        button.html("重新发送验证码");       
    }  
    else {  
        detail_countdown--;  
       button.text("倒计时"+detail_countdown+ "秒");  
    }  
}
function login2(){

  var mobile = $('#mobile').val();
  var yzm = $('#yzm').val();
  var gender = $('input[name="gender"]:checked').val();
  var check = '1';
  if(mobile==''){
    //alert('请输入你的手机号');
	tip('请输入你的手机号',true);
	check = '2';
	return;
  }
  if(yzm==''){
    //alert('请输入验证码');
	tip('请输入验证码',true);
	check = '2';
	return;
  }
  
  if(gender==''){
	
	check = '2';
	return;
  }
  tip('加载中...');
  if(check == '1'){
       $.ajax({
				type : "POST",
				url: '{php echo $this->createMobileUrl('smspost')}',
				data:{'mobile':mobile,'yzm':yzm,'gender':gender},
				dataType:'JSON',
				success: function (data) {
					if (data.error == 0) {
						tip('验证成功',true);
						   window.location.href="{php echo $this->createMobileUrl('alllist')}"; 
					} else {
						
						tip(data.message,true);
					}
				}   
			});
  }
}
function tip(msg,autoClose){
	var div = $("#poptip");
	var content =$("#poptip_content");
	if(div.length<=0){
		div = $("<span id='poptip'></span>").appendTo(document.body);
		content =$("<span id='poptip_content'>" + msg + "</span>").appendTo(document.body);
	}else{
		content.html(msg);
		content.show(); 
		div.show();
	}
	if(autoClose) {
		setTimeout(function(){
			content.hide();
			div.hide();
		},2000);
	}
   }
	function tip_close(){
		$("#poptip").hide();
		$("#poptip_content").hide();
	}
</script>

{template 'footer'}
